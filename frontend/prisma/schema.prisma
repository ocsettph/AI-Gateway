generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  username   String   @unique
  role       String   @default("user")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  apiKeys    ApiKey[]
}

model ApiKey {
  id          String   @id @default(cuid())
  name        String
  prefix      String   // short public prefix for display
  secretHash  String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  limitUsd    Float?
  limitReset  String?  // daily | weekly | monthly | null
  createdAt   DateTime @default(now())
  revokedAt   DateTime?
  usageLogs   UsageLog[]
}

model UsageLog {
  id        String   @id @default(cuid())
  apiKeyId  String
  apiKey    ApiKey   @relation(fields: [apiKeyId], references: [id])
  path      String
  costUsd   Float     @default(0)
  createdAt DateTime  @default(now())
}


