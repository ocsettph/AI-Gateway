import{e as R,u as H,r as _,h as j,g as u,m as l,c as n,a,p as y,b as $,w as E,j as O,F as C,l as A,_ as F,o as d,d as m,t as i,k as M,q as U,s as P,n as w}from"#entry";const z={class:"min-h-screen py-10 bg-transparent dark:bg-transparent"},Z={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},G={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 md:p-8"},J={class:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4"},Q={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},W={key:0,class:"text-center py-8"},X={key:1,class:"text-center py-12"},Y={key:2,class:"space-y-4"},q={class:"flex flex-col md:flex-row md:justify-between md:items-start gap-4"},tt={class:"flex-1 min-w-0"},et={class:"flex items-center gap-2 mb-2"},at={key:0,class:"font-semibold text-gray-900 dark:text-white break-words"},rt={key:1,class:"flex items-center gap-2 flex-1"},st=["onUpdate:modelValue","onKeyup","data-key-id"],ot=["onClick"],it=["onClick"],nt=["onClick"],dt={class:"text-sm text-gray-600 dark:text-gray-300 mb-2"},lt=["value"],ct={class:"flex flex-wrap items-center gap-2 md:gap-4 text-sm text-gray-500 dark:text-gray-400"},ut={class:"whitespace-nowrap"},mt={class:"whitespace-nowrap"},pt={class:"whitespace-nowrap"},gt={class:"mt-2 text-xs text-gray-400 dark:text-gray-500"},_t={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-shrink-0"},xt=["onClick"],ft=["onClick"],yt=["onClick"],wt={key:0,class:"mt-8 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 md:p-8"},ht={class:"space-y-4"},bt={class:"flex flex-col md:flex-row md:justify-between md:items-start gap-4"},vt={class:"flex-1 min-w-0"},kt={class:"font-semibold text-gray-900 dark:text-white mb-2 break-words"},$t={class:"text-sm text-gray-600 dark:text-gray-300 space-y-1"},Et={class:"mt-2 text-xs text-gray-400 dark:text-gray-500"},Ct={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-shrink-0"},At=["onClick"],It=R({__name:"keys",setup(Pt){H({title:"จัดการ API Keys - UBU AI SERVICE",meta:[{name:"description",content:"ดูและจัดการ API Key ที่ได้รับการอนุมัติแล้ว"}]});const g=_([]),p=_([]),h=_(!0),c=_({}),x=async()=>{try{const r=u().public.apiBase,e=await $fetch(`${r}/api/keys`,{credentials:"include"});g.value=e.keys,await Promise.all(g.value.map(async t=>{try{const o=await $fetch(`${r}/api/keys/usage`,{params:{value:t.key_value},credentials:"include"});t._used=Number(o?.total?.cost_usd||0)}catch{t._used=Number(t.current_spend||0)}}));const s=await $fetch(`${r}/api/requests`,{credentials:"include"});p.value=s.requests.filter(t=>t.status==="pending")}catch(r){console.error("Error fetching data:",r)}finally{h.value=!1}},B=async r=>{try{const e=u().public.apiBase;await $fetch(`${e}/api/keys/${r.id}/toggle`,{method:"PATCH",credentials:"include"}),r.is_active=!r.is_active}catch(e){console.error("Error toggling key:",e);try{await(await l(async()=>{const{default:t}=await import("./DrhBs4VY.js");return{default:t}},[],import.meta.url)).default.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถเปลี่ยนสถานะ API Key ได้"})}catch{}}},I=async r=>{try{await navigator.clipboard.writeText(r);try{await(await l(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"success",title:"คัดลอกแล้ว",text:"คัดลอก API Key เรียบร้อยแล้ว"})}catch{}}catch(e){console.error("Error copying key:",e);try{await(await l(async()=>{const{default:t}=await import("./DrhBs4VY.js");return{default:t}},[],import.meta.url)).default.fire({icon:"error",title:"คัดลอกไม่สำเร็จ",text:"ไม่สามารถคัดลอก API Key ได้"})}catch{}}},T=async()=>{try{const r=u().public.apiBase;await $fetch(`${r}/api/keys/refresh`,{method:"POST",credentials:"include"}),await x()}catch{}},K=async r=>{try{if(!(await(await l(async()=>{const{default:t}=await import("./DrhBs4VY.js");return{default:t}},[],import.meta.url)).default.fire({icon:"warning",title:"ลบ API Key นี้?",text:"การลบไม่สามารถย้อนกลับได้",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)return}catch{}try{const e=u().public.apiBase;await $fetch(`${e}/api/keys/${r.id}`,{method:"DELETE",credentials:"include"}),await x()}catch{try{await(await l(async()=>{const{default:t}=await import("./DrhBs4VY.js");return{default:t}},[],import.meta.url)).default.fire({icon:"error",title:"ลบไม่สำเร็จ",text:"เกิดข้อผิดพลาดในการลบ API Key"})}catch{}}},S=r=>{c.value[r.id]=r.name,setTimeout(()=>{const e=document.querySelector(`input[data-key-id="${r.id}"]`);e&&e.focus()},0)},b=async r=>{const e=c.value[r.id]?.trim();if(!e||e===r.name){f(r.id);return}try{const s=u().public.apiBase,t=await $fetch(`${s}/api/keys/${r.id}`,{method:"PATCH",body:{name:e},credentials:"include"});r.name=e,delete c.value[r.id];try{await(await l(async()=>{const{default:L}=await import("./DrhBs4VY.js");return{default:L}},[],import.meta.url)).default.fire({icon:"success",title:"บันทึกสำเร็จ",text:"แก้ไขชื่อ API Key เรียบร้อยแล้ว"})}catch{}}catch(s){console.error("Error updating key name:",s);try{await(await l(async()=>{const{default:o}=await import("./DrhBs4VY.js");return{default:o}},[],import.meta.url)).default.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถแก้ไขชื่อ API Key ได้"})}catch{}}},f=r=>{delete c.value[r]},D=async r=>{try{if(!(await(await l(async()=>{const{default:t}=await import("./DrhBs4VY.js");return{default:t}},[],import.meta.url)).default.fire({icon:"warning",title:"ลบคำขอใช่หรือไม่?",text:"การลบนี้ไม่สามารถย้อนกลับได้",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)return}catch{}try{const e=u().public.apiBase;await $fetch(`${e}/api/requests/${r.id}`,{method:"DELETE",credentials:"include"}),p.value=p.value.filter(s=>s.id!==r.id)}catch(e){console.error("Error deleting request:",e)}},N=r=>{switch(r){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},V=r=>{switch(r){case"pending":return"รอการอนุมัติ";case"approved":return"อนุมัติแล้ว";case"rejected":return"ปฏิเสธ";default:return"ไม่ทราบ"}},v=r=>new Date(r).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Bangkok"});function k(r){const e=Number(r||0);return!isFinite(e)||e===0?"0.00":e>0&&e<.01?e.toFixed(4):e.toFixed(2)}return j(()=>{x(),(async()=>{try{const r=u().public.apiBase,s=(await $fetch(`${r}/api/notifications`,{credentials:"include"})).notifications||[];if(s.length>0){try{const t=(await l(async()=>{const{default:o}=await import("./DrhBs4VY.js");return{default:o}},[],import.meta.url)).default;for(const o of s)await t.fire({icon:"info",title:o.title,text:o.message,confirmButtonText:"รับทราบ"})}catch{}await $fetch(`${r}/api/notifications/read`,{method:"PATCH",credentials:"include"})}}catch{}})()}),(r,e)=>{const s=F;return d(),n("div",z,[a("div",Z,[e[12]||(e[12]=a("div",{class:"mb-8"},[a("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white mb-2"},"จัดการ API Keys"),a("p",{class:"text-gray-600 dark:text-gray-300"},"ดูและจัดการ API Key ที่ได้รับการอนุมัติแล้ว")],-1)),a("div",G,[a("div",J,[e[1]||(e[1]=a("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"API Keys ของคุณ",-1)),a("div",Q,[a("button",{onClick:T,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm whitespace-nowrap"},"รีเฟรช usage"),$(s,{to:"/request",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm whitespace-nowrap text-center"},{default:E(()=>[...e[0]||(e[0]=[m(" + ขอ API Key ใหม่ ",-1)])]),_:1})])]),h.value?(d(),n("div",W,[...e[2]||(e[2]=[a("div",{class:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"},null,-1),a("p",{class:"text-gray-500 dark:text-gray-400"},"กำลังโหลดข้อมูล...",-1)])])):g.value.length===0?(d(),n("div",X,[e[4]||(e[4]=O('<div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1721 9z"></path></svg></div><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">ยังไม่มี API Key</h3><p class="text-gray-500 dark:text-gray-400 mb-6">คุณยังไม่มี API Key ที่ได้รับการอนุมัติ</p>',3)),$(s,{to:"/request",class:"inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"},{default:E(()=>[...e[3]||(e[3]=[a("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),m(" ขอ API Key ใหม่ ",-1)])]),_:1})])):(d(),n("div",Y,[(d(!0),n(C,null,A(g.value,t=>(d(),n("div",{key:t.id,class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 md:p-6 hover:shadow-md transition-shadow"},[a("div",q,[a("div",tt,[a("div",et,[c.value[t.id]?(d(),n("div",rt,[M(a("input",{"onUpdate:modelValue":o=>c.value[t.id]=o,onKeyup:[P(o=>b(t),["enter"]),P(o=>f(t.id),["esc"])],"data-key-id":t.id,class:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,40,st),[[U,c.value[t.id]]]),a("button",{onClick:o=>b(t),class:"px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-colors"}," บันทึก ",8,ot),a("button",{onClick:o=>f(t.id),class:"px-2 py-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-xs hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"}," ยกเลิก ",8,it)])):(d(),n("h3",at,i(t.name),1)),c.value[t.id]?y("",!0):(d(),n("button",{key:2,onClick:o=>S(t),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:"แก้ไขชื่อ"},[...e[5]||(e[5]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,nt))]),a("p",dt,[e[6]||(e[6]=a("span",{class:"font-medium"},"Key:",-1)),a("input",{value:t.key_value,readonly:"",class:"mt-1 w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-600 text-gray-700 dark:text-gray-300"},null,8,lt)]),a("div",ct,[a("span",ut,"เครดิต: $"+i(Number(t.credit_limit||0).toFixed(2)),1),a("span",mt,"ใช้งานแล้ว: $"+i(k((t._used??t.current_spend)||0)),1),a("span",pt,"คงเหลือ: $"+i(k(Number(t.credit_limit||0)-Number((t._used??t.current_spend)||0))),1),a("span",{class:w(["px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap",t.is_active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"])},i(t.is_active?"ใช้งานได้":"ปิดใช้งาน"),3)]),a("div",gt," สร้างเมื่อ: "+i(v(t.created_at)),1)]),a("div",_t,[a("button",{onClick:o=>B(t),class:w([t.is_active?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900 dark:text-red-200 dark:hover:bg-red-800":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900 dark:text-green-200 dark:hover:bg-green-800","px-3 py-2 rounded text-sm font-medium transition-colors whitespace-nowrap"])},i(t.is_active?"ปิดใช้งาน":"เปิดใช้งาน"),11,xt),a("button",{onClick:o=>K(t),class:"px-3 py-2 bg-red-600 text-white hover:bg-red-700 rounded text-sm font-medium transition-colors whitespace-nowrap"}," ลบ ",8,ft),a("button",{onClick:o=>I(t.key_value),class:"px-3 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800 rounded text-sm font-medium transition-colors whitespace-nowrap"}," คัดลอก Key ",8,yt)])])]))),128))]))]),p.value.length>0?(d(),n("div",wt,[e[11]||(e[11]=a("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-6"},"คำขอที่รอการอนุมัติ",-1)),a("div",ht,[(d(!0),n(C,null,A(p.value,t=>(d(),n("div",{key:t.id,class:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 md:p-6 border border-yellow-200 dark:border-yellow-800"},[a("div",bt,[a("div",vt,[a("h3",kt,i(t.api_key_name),1),a("div",$t,[a("p",null,[e[7]||(e[7]=a("span",{class:"font-medium"},"ชื่อ:",-1)),m(" "+i(t.first_name)+" "+i(t.last_name),1)]),a("p",null,[e[8]||(e[8]=a("span",{class:"font-medium"},"อีเมล:",-1)),m(" "+i(t.email),1)]),a("p",null,[e[9]||(e[9]=a("span",{class:"font-medium"},"คณะ:",-1)),m(" "+i(t.department||"ไม่ระบุ"),1)]),a("p",null,[e[10]||(e[10]=a("span",{class:"font-medium"},"เครดิต:",-1)),m(" $"+i(t.credit_limit),1)])]),a("div",Et," ส่งคำขอเมื่อ: "+i(v(t.created_at)),1)]),a("div",Ct,[a("span",{class:w(["px-3 py-1 rounded-full text-sm font-medium text-center whitespace-nowrap",N(t.status)])},i(V(t.status)),3),t.status==="pending"?(d(),n("button",{key:0,onClick:o=>D(t),class:"px-3 py-2 bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900 dark:text-red-200 dark:hover:bg-red-800 rounded text-sm font-medium transition-colors whitespace-nowrap"}," ลบคำขอ ",8,At)):y("",!0)])])]))),128))])])):y("",!0)])])}}});export{It as default};
