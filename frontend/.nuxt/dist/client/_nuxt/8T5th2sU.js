import{e as F,r as x,f as z,g as S,h as q,c as n,a as t,p as P,b as G,w as J,k as p,q as b,v as Q,F as T,l as D,j as W,d as m,t as o,n as E,E as X,m as u,_ as Y,o as l,s as A}from"#entry";const Z={class:"min-h-screen bg-transparent dark:bg-transparent py-8"},tt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},et={class:"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},st={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:p-6 mb-6"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mb-4"},rt=["value"],ot={class:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4"},it={class:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-700 dark:to-gray-800 rounded-lg p-4 md:p-5"},dt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},nt={class:"md:col-span-2"},lt={class:"relative"},ct={class:"flex flex-col gap-2"},ut=["disabled"],xt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},mt={key:1,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},gt=["disabled"],pt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yt={key:1,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},vt={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},_t={class:"px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 dark:border-gray-700"},ft={class:"text-base md:text-lg font-medium text-gray-900 dark:text-white"},bt={class:"md:hidden p-4 space-y-4"},ht={class:"flex items-start justify-between"},wt={class:"flex-1 min-w-0"},kt={class:"flex items-center gap-2 mb-1"},Ct={key:0,class:"text-sm font-semibold text-gray-900 dark:text-white break-words"},$t={key:1,class:"flex items-center gap-2 flex-1"},St=["onUpdate:modelValue","onKeyup","data-key-id"],Et=["onClick"],At=["onClick"],Bt=["onClick"],Vt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono"},Pt=["onClick"],Tt={class:"space-y-2 text-sm"},Dt={class:"text-gray-900 dark:text-white break-words"},Lt={class:"text-xs text-gray-500 dark:text-gray-400 break-all"},It={class:"text-gray-900 dark:text-white"},Nt={class:"text-gray-900 dark:text-white"},jt={class:"flex items-center gap-2"},Mt=["onUpdate:modelValue"],Ut={class:"flex flex-col gap-2 pt-2 border-t border-gray-200 dark:border-gray-600"},zt=["onClick"],Ot={class:"grid grid-cols-2 gap-2"},Rt=["onClick"],Ht=["onClick"],Kt={class:"hidden md:block overflow-x-auto -mx-4 md:mx-0"},Ft={class:"min-w-full text-xs md:text-sm divide-y divide-gray-200 dark:divide-gray-700 text-gray-900 dark:text-gray-100"},qt={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700 text-gray-900 dark:text-gray-100"},Gt={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4"},Jt={class:"flex items-center gap-2"},Qt={class:"flex-1 min-w-0"},Wt={key:0,class:"text-xs md:text-sm font-medium break-words"},Xt={key:1,class:"flex items-center gap-2"},Yt=["onUpdate:modelValue","onKeyup","data-key-id"],Zt=["onClick"],te=["onClick"],ee=["onClick"],se={class:"text-xs text-gray-400 mt-1"},ae={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm"},re={class:"break-words"},oe={class:"text-xs text-gray-400 break-all"},ie={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm"},de={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm"},ne={class:"flex items-center gap-1 md:gap-2"},le=["onUpdate:modelValue"],ce={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm"},ue={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm"},xe=["onClick"],me={class:"px-3 md:px-4 lg:px-6 py-3 md:py-4 text-xs md:text-sm text-right"},ge={class:"flex flex-col sm:flex-row items-end sm:items-center gap-1 md:gap-2"},pe=["onClick"],ye=["onClick"],ve=["onClick"],_e={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},fe={class:"bg-white dark:bg-neutral-800 text-gray-900 dark:text-gray-100 rounded-lg shadow-lg w-full max-w-md md:w-[520px] max-h-[90vh] overflow-y-auto p-4 md:p-6"},be={class:"flex items-center justify-between mb-4"},he={class:"space-y-2 text-sm"},we={class:"mt-2"},ke={class:"break-all bg-gray-100 dark:bg-neutral-700 px-2 py-1 rounded"},Ce={class:"mt-3"},$e={class:"flex items-center justify-between mb-1"},Se={class:"text-xs"},Ee={class:"w-full bg-gray-200 dark:bg-neutral-700 rounded h-2"},Ae={class:"grid grid-cols-2 gap-3 mt-3"},Be={class:"font-medium"},Ve={class:"font-medium"},Pe={class:"mt-5 flex justify-end space-x-2"},Le=F({__name:"keys",setup(Te){const B=x(""),V=x(""),y=x([]),C=x(!1),i=x(null),c=x({}),g=x(30),h=x(!1),w=x(!1),L=z(()=>{if(!i.value)return 0;const a=Number((i.value._used??i.value.current_spend)||0),e=Number(i.value._credit||i.value.credit_limit||0);if(e<=0)return a>0?100:0;const d=a/e*100;return Math.min(100,Math.max(0,d))}),O=z(()=>{const a=new Set;for(const e of y.value)e.faculty&&a.add(e.faculty);return Array.from(a).sort()}),v=S().public.apiBase,_=async()=>{const a=await $fetch(`${v}/api/admin/keys`,{params:{q:B.value,department:V.value},credentials:"include"});y.value=(a.keys||[]).map(e=>({...e,_credit:Number(e.credit_limit||0)})),await Promise.all(y.value.map(async e=>{try{const d=await $fetch(`${v}/api/keys/usage`,{params:{value:e.key_value},credentials:"include"});e._used=Number(d?.total?.cost_usd||0)}catch{e._used=Number(e.current_spend||0)}}))},I=async a=>{try{await $fetch(`${v}/api/admin/keys/${a.id}`,{method:"PATCH",body:{credit_limit:a._credit,is_active:a.is_active},credentials:"include"}),await _()}catch{try{await(await u(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"error",title:"บันทึกไม่สำเร็จ"})}catch{}}},N=a=>{c.value[a.id]=a.name,setTimeout(()=>{const e=document.querySelector(`input[data-key-id="${a.id}"]`);e&&e.focus()},0)},$=async a=>{const e=c.value[a.id]?.trim();if(!e||e===a.name){k(a.id);return}try{await $fetch(`${v}/api/admin/keys/${a.id}`,{method:"PATCH",body:{name:e},credentials:"include"}),a.name=e,delete c.value[a.id];try{await(await u(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"success",title:"บันทึกสำเร็จ",text:"แก้ไขชื่อ API Key เรียบร้อยแล้ว"})}catch{}}catch(d){console.error("Error updating key name:",d);try{await(await u(async()=>{const{default:r}=await import("./DrhBs4VY.js");return{default:r}},[],import.meta.url)).default.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถแก้ไขชื่อ API Key ได้"})}catch{}}},k=a=>{delete c.value[a]},j=a=>{i.value={...a},C.value=!0},M=async a=>{try{if(!(await(await u(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"warning",title:"ลบคีย์นี้?",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed)return}catch{}try{await $fetch(`${v}/api/admin/keys/${a.id}`,{method:"DELETE",credentials:"include"}),await _()}catch{try{await(await u(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"error",title:"ลบคีย์ไม่สำเร็จ"})}catch{}}},U=async a=>{try{await $fetch(`${v}/api/admin/keys/${a.id}`,{method:"PATCH",body:{is_active:!a.is_active},credentials:"include"}),await _()}catch{}};async function R(){try{const a=S().public.apiBase,e=await $fetch(`${a}/api/admin/settings`,{credentials:"include"});e.settings?.auto_disable_inactive_days?.value&&(g.value=Number(e.settings.auto_disable_inactive_days.value))}catch(a){console.error("Error loading settings:",a)}}async function H(){if(!g.value||g.value<1){try{await(await u(async()=>{const{default:e}=await import("./DrhBs4VY.js");return{default:e}},[],import.meta.url)).default.fire({icon:"warning",title:"กรุณากรอกจำนวนวันให้ถูกต้อง",text:"จำนวนวันต้องมากกว่า 0"})}catch{}return}h.value=!0;try{const a=S().public.apiBase,e=await $fetch(`${a}/api/admin/settings`,{method:"PATCH",credentials:"include",body:{key:"auto_disable_inactive_days",value:g.value}});console.log("✅ Settings saved:",e);try{await(await u(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"success",title:"บันทึกการตั้งค่าสำเร็จ",html:`
          <div class="text-left">
            <p class="mb-2">บันทึกการตั้งค่าการปิดการใช้งานอัตโนมัติเรียบร้อยแล้ว</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              จำนวนวันที่ตั้งค่า: <strong>${g.value}</strong> วัน
            </p>
          </div>
        `,confirmButtonColor:"#10b981"})}catch{}}catch(a){console.error("❌ Error saving settings:",a);try{await(await u(async()=>{const{default:d}=await import("./DrhBs4VY.js");return{default:d}},[],import.meta.url)).default.fire({icon:"error",title:"บันทึกการตั้งค่าไม่สำเร็จ",text:a?.message||"เกิดข้อผิดพลาดในการบันทึกการตั้งค่า"})}catch{}}finally{h.value=!1}}async function K(){try{const a=(await u(async()=>{const{default:r}=await import("./DrhBs4VY.js");return{default:r}},[],import.meta.url)).default;if(!(await a.fire({icon:"warning",title:"ยืนยันการปิดการใช้งานอัตโนมัติ",html:`
        <div class="text-left">
          <p class="mb-2">คุณต้องการปิดการใช้งาน API keys ที่ไม่ได้ใช้งานอัตโนมัติหรือไม่?</p>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            ระบบจะปิดการใช้งาน API keys ที่ไม่ได้ใช้งานเกิน <strong>${g.value}</strong> วัน
          </p>
        </div>
      `,showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",confirmButtonColor:"#f97316",cancelButtonColor:"#6b7280"})).isConfirmed)return;w.value=!0;const d=S().public.apiBase,s=await $fetch(`${d}/api/admin/auto-disable-inactive`,{method:"POST",credentials:"include"});await a.fire({icon:s.disabled_count>0?"success":"info",title:s.disabled_count>0?"สำเร็จ":"ไม่พบ API keys ที่ต้องปิด",html:`
        <div class="text-left">
          <p class="mb-2">${s.message||`ปิดการใช้งาน ${s.disabled_count} API keys`}</p>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            จำนวนวันที่ตั้งค่า: <strong>${s.days}</strong> วัน
          </p>
        </div>
      `,confirmButtonColor:"#10b981"}),await _()}catch(a){console.error("Error running auto-disable:",a);try{await(await u(async()=>{const{default:d}=await import("./DrhBs4VY.js");return{default:d}},[],import.meta.url)).default.fire({icon:"error",title:"ปิดการใช้งานอัตโนมัติไม่สำเร็จ",text:a?.message||"เกิดข้อผิดพลาดในการปิดการใช้งานอัตโนมัติ"})}catch{}}finally{w.value=!1}}q(async()=>{await R(),await _()});function f(a){const e=Number(a||0);return!isFinite(e)||e===0?"0.00":e>0&&e<.01?e.toFixed(4):e.toFixed(2)}return(a,e)=>{const d=Y;return l(),n("div",Z,[t("div",tt,[t("div",et,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white"},"จัดการ API Keys (Admin)"),t("p",{class:"mt-2 text-sm sm:text-base text-gray-600 dark:text-gray-400"},"ดูและแก้ไขเครดิต/สถานะของคีย์ทั้งหมด")],-1)),G(d,{to:"/",class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm whitespace-nowrap text-center"},{default:J(()=>[...e[5]||(e[5]=[m("กลับ",-1)])]),_:1})]),t("div",st,[t("div",at,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"ค้นหา (ชื่อคีย์/ผู้ใช้/อีเมล)",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>B.value=s),type:"text",class:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white",placeholder:"พิมพ์คำค้น..."},null,512),[[b,B.value]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"กรองตามคณะ/หน่วยงาน",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),class:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:text-white"},[e[8]||(e[8]=t("option",{value:""},"ทั้งหมด",-1)),(l(!0),n(T,null,D(O.value,s=>(l(),n("option",{key:s,value:s},o(s),9,rt))),128))],512),[[Q,V.value]])]),t("div",{class:"flex items-end"},[t("button",{onClick:_,class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"},"ค้นหา")])]),t("div",ot,[e[17]||(e[17]=W('<div class="flex items-center gap-2 mb-4"><svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><h3 class="text-base font-semibold text-gray-900 dark:text-white">ตั้งค่าการปิดการใช้งานอัตโนมัติ</h3></div>',1)),t("div",it,[t("div",dt,[t("div",nt,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[t("span",{class:"flex items-center gap-2"},[t("svg",{class:"w-4 h-4 text-indigo-600 dark:text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),m(" จำนวนวันที่ไม่ได้ใช้งานก่อนปิดอัตโนมัติ (วัน) ")])],-1)),t("div",lt,[p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),type:"number",min:"1",class:"w-full px-4 py-2.5 border-2 border-indigo-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white transition-all",placeholder:"30"},null,512),[[b,g.value,void 0,{number:!0}]]),e[10]||(e[10]=t("div",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"},"วัน",-1))]),e[12]||(e[12]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"API keys ที่ไม่ได้ใช้งานเกินจำนวนวันนี้จะถูกปิดอัตโนมัติ",-1))]),t("div",ct,[t("button",{onClick:H,disabled:h.value,class:"px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2"},[h.value?(l(),n("svg",mt,[...e[14]||(e[14]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(l(),n("svg",xt,[...e[13]||(e[13]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),m(" "+o(h.value?"กำลังบันทึก...":"บันทึกการตั้งค่า"),1)],8,ut),t("button",{onClick:K,disabled:w.value,class:"px-4 py-2.5 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg hover:from-orange-700 hover:to-red-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2"},[w.value?(l(),n("svg",yt,[...e[16]||(e[16]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(l(),n("svg",pt,[...e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])),m(" "+o(w.value?"กำลังดำเนินการ...":"ปิดการใช้งานอัตโนมัติ"),1)],8,gt)])])])])]),t("div",vt,[t("div",_t,[t("h3",ft,"รายการคีย์ทั้งหมด ("+o(y.value.length)+")",1)]),t("div",bt,[(l(!0),n(T,null,D(y.value,s=>(l(),n("div",{key:s.id,class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3"},[t("div",ht,[t("div",wt,[t("div",kt,[c.value[s.id]?(l(),n("div",$t,[p(t("input",{"onUpdate:modelValue":r=>c.value[s.id]=r,onKeyup:[A(r=>$(s),["enter"]),A(r=>k(s.id),["esc"])],"data-key-id":s.id,class:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,40,St),[[b,c.value[s.id]]]),t("button",{onClick:r=>$(s),class:"px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-colors"}," บันทึก ",8,Et),t("button",{onClick:r=>k(s.id),class:"px-2 py-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-xs hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"}," ยกเลิก ",8,At)])):(l(),n("h3",Ct,o(s.name),1)),c.value[s.id]?P("",!0):(l(),n("button",{key:2,onClick:r=>N(s),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0",title:"แก้ไขชื่อ"},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Bt))]),t("div",Vt,o(s.key_value?.slice(0,16))+"…",1)]),t("button",{onClick:r=>U(s),class:E([s.is_active?"bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 hover:bg-red-200 dark:bg-red-900 dark:text-red-200","px-2 py-1 rounded text-xs font-semibold whitespace-nowrap flex-shrink-0 ml-2"])},o(s.is_active?"Active":"Disabled"),11,Pt)]),t("div",Tt,[t("div",null,[e[19]||(e[19]=t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"ผู้ใช้:",-1)),t("div",Dt,o(s.fullname),1),t("div",Lt,o(s.email),1)]),t("div",null,[e[20]||(e[20]=t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"คณะ/หน่วยงาน:",-1)),t("span",It,o(s.faculty||"ไม่ระบุ"),1)]),t("div",null,[e[21]||(e[21]=t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"ใช้งานแล้ว:",-1)),t("span",Nt,"$"+o(f((s._used??s.current_spend)||0)),1)])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},"เครดิต (USD)",-1)),t("div",jt,[p(t("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":r=>s._credit=r,class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-600 dark:text-white text-sm"},null,8,Mt),[[b,s._credit,void 0,{number:!0}]]),e[22]||(e[22]=t("span",{class:"text-xs text-gray-500"},"USD",-1))])]),t("div",Ut,[t("button",{onClick:r=>j(s),class:"w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white rounded text-gray-900 text-sm font-medium"}," รายละเอียด ",8,zt),t("div",Ot,[t("button",{onClick:r=>I(s),class:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm font-medium"}," บันทึก ",8,Rt),t("button",{onClick:r=>M(s),class:"px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm font-medium"}," ลบ ",8,Ht)])])]))),128))]),t("div",Kt,[t("table",Ft,[e[26]||(e[26]=t("thead",{class:"bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200"},[t("tr",null,[t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"ชื่อคีย์"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"ผู้ใช้"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"คณะ/หน่วยงาน"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"เครดิต"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"ใช้งานแล้ว"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-left text-xs font-medium"},"สถานะ"),t("th",{class:"px-3 md:px-4 lg:px-6 py-3 text-right text-xs font-medium"},"จัดการ")])],-1)),t("tbody",qt,[(l(!0),n(T,null,D(y.value,s=>(l(),n("tr",{key:s.id},[t("td",Gt,[t("div",Jt,[t("div",Qt,[c.value[s.id]?(l(),n("div",Xt,[p(t("input",{"onUpdate:modelValue":r=>c.value[s.id]=r,onKeyup:[A(r=>$(s),["enter"]),A(r=>k(s.id),["esc"])],"data-key-id":s.id,class:"flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",autofocus:""},null,40,Yt),[[b,c.value[s.id]]]),t("button",{onClick:r=>$(s),class:"px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700 transition-colors"}," บันทึก ",8,Zt),t("button",{onClick:r=>k(s.id),class:"px-2 py-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded text-xs hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"}," ยกเลิก ",8,te)])):(l(),n("div",Wt,o(s.name),1))]),c.value[s.id]?P("",!0):(l(),n("button",{key:0,onClick:r=>N(s),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors flex-shrink-0",title:"แก้ไขชื่อ"},[...e[24]||(e[24]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ee))]),t("div",se,o(s.key_value?.slice(0,8))+"…",1)]),t("td",ae,[t("div",re,o(s.fullname),1),t("div",oe,o(s.email),1)]),t("td",ie,o(s.faculty||"-"),1),t("td",de,[t("div",ne,[p(t("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":r=>s._credit=r,class:"w-16 md:w-20 lg:w-24 px-1 md:px-2 py-1 border rounded dark:bg-gray-700 dark:text-white text-xs"},null,8,le),[[b,s._credit,void 0,{number:!0}]]),e[25]||(e[25]=t("span",{class:"text-xs text-gray-500 whitespace-nowrap"},"USD",-1))])]),t("td",ce,"$"+o(f((s._used??s.current_spend)||0)),1),t("td",ue,[t("button",{onClick:r=>U(s),class:E([s.is_active?"bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 hover:bg-red-200 dark:bg-red-900 dark:text-red-200","px-2 py-1 rounded text-xs font-semibold whitespace-nowrap"])},o(s.is_active?"Active":"Disabled"),11,xe)]),t("td",me,[t("div",ge,[t("button",{onClick:r=>j(s),class:"px-2 md:px-3 py-1 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white rounded text-gray-900 whitespace-nowrap text-xs"},"รายละเอียด",8,pe),t("button",{onClick:r=>I(s),class:"px-2 md:px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 whitespace-nowrap text-xs"},"บันทึก",8,ye),t("button",{onClick:r=>M(s),class:"px-2 md:px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 whitespace-nowrap text-xs"},"ลบ",8,ve)])])]))),128))])])])]),C.value?(l(),n("div",_e,[t("div",fe,[t("div",be,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold"},"รายละเอียดคีย์",-1)),t("button",{onClick:e[3]||(e[3]=s=>C.value=!1),class:"text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200"},"✕")]),t("div",he,[t("div",null,[e[28]||(e[28]=t("span",{class:"font-medium"},"ชื่อ:",-1)),m(" "+o(i.value?.name),1)]),t("div",null,[e[29]||(e[29]=t("span",{class:"font-medium"},"ผู้ใช้:",-1)),m(" "+o(i.value?.fullname)+" ("+o(i.value?.email)+")",1)]),t("div",null,[e[30]||(e[30]=t("span",{class:"font-medium"},"คณะ/หน่วยงาน:",-1)),m(" "+o(i.value?.faculty||"-"),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"font-medium"},"สถานะ:",-1)),e[32]||(e[32]=m()),t("span",{class:E(i.value?.is_active?"text-green-600":"text-red-600")},o(i.value?.is_active?"เปิดใช้งาน":"ปิดใช้งาน"),3)]),t("div",we,[e[33]||(e[33]=t("span",{class:"font-medium"},"คีย์:",-1)),e[34]||(e[34]=m()),t("code",ke,o(i.value?.key_value),1)]),t("div",Ce,[t("div",$e,[e[35]||(e[35]=t("span",{class:"font-medium"},"การใช้งาน",-1)),t("span",Se,"$"+o(f(i.value?._used??i.value?.current_spend))+" / $"+o(f(i.value?._credit||i.value?.credit_limit||0)),1)]),t("div",Ee,[t("div",{class:E([[L.value>=100||(i.value?._credit||i.value?.credit_limit||0)<=0&&(i.value?._used??i.value?.current_spend)>0?"bg-red-600":"bg-indigo-600"],"h-2 rounded transition-colors"]),style:X({width:Math.min(100,L.value)+"%"})},null,6)])]),t("div",Ae,[t("div",null,[e[36]||(e[36]=t("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"Limit",-1)),t("div",Be,"$"+o(f(i.value?._credit||i.value?.credit_limit)),1)]),t("div",null,[e[37]||(e[37]=t("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"Used",-1)),t("div",Ve,"$"+o(f(i.value?._used??i.value?.current_spend)),1)])])]),t("div",Pe,[t("button",{onClick:e[4]||(e[4]=s=>C.value=!1),class:"px-3 py-2 bg-gray-100 dark:bg-neutral-700 hover:bg-gray-200 dark:hover:bg-neutral-600 rounded"},"ปิด")])])])):P("",!0)])])}}});export{Le as default};
