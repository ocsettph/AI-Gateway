import{e as E,r as c,g as j,f as w,h as A,c as n,a as e,b as D,w as R,k as b,q as V,v as B,F as k,l as h,M as P,C as M,m as g,_ as O,o as i,d as l,t as r}from"#entry";const N={class:"min-h-screen bg-transparent dark:bg-transparent py-8"},I={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},F={class:"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},U={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:p-6"},H={class:"mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},K=["value"],Q={key:0,class:"text-center py-8"},Z={key:1},z={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},G={key:1,class:"space-y-4"},J={class:"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4"},W={class:"flex-1 min-w-0"},X={class:"text-base md:text-lg font-semibold text-gray-900 dark:text-white mb-1 break-words"},Y={class:"text-sm text-gray-700 dark:text-gray-300 grid grid-cols-1 md:grid-cols-2 gap-x-4 md:gap-x-8 gap-y-1"},q={class:"break-all"},tt={class:"md:col-span-2"},et={class:"md:col-span-2"},st={class:"text-xs text-gray-500 dark:text-gray-400 md:col-span-2"},at={class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-shrink-0 lg:ml-4"},ot=["disabled","onClick"],rt=["disabled","onClick"],it=E({__name:"requests",setup(lt){const x=c(!0),d=c([]),p=c(""),m=c(""),u=c(null),v=j().public.apiBase,S=async()=>{x.value=!0;try{const a=await $fetch(`${v}/api/admin/requests`,{credentials:"include"});d.value=(a.requests||[]).filter(s=>s.status==="pending");const o=P().query.approve;if(o){const s=Number(o),f=d.value.find($=>$.id===s);f&&(await _(f),await M({query:{}}))}}catch(a){console.error("Error loading admin requests:",a)}finally{x.value=!1}},C=w(()=>{const a=new Set;for(const t of d.value)t.department&&a.add(t.department);return Array.from(a).sort()}),y=w(()=>{let a=d.value;if(p.value){const t=p.value.toLowerCase();a=a.filter(o=>(o.first_name+" "+o.last_name).toLowerCase().includes(t)||String(o.email||"").toLowerCase().includes(t)||String(o.ubuaccount||"").toLowerCase().includes(t))}return m.value&&(a=a.filter(t=>t.department===m.value)),a}),_=async a=>{try{u.value=a.id,await $fetch(`${v}/api/admin/requests/${a.id}/approve`,{method:"POST",credentials:"include"}),d.value=d.value.filter(t=>t.id!==a.id);try{await(await g(async()=>{const{default:o}=await import("./DrhBs4VY.js");return{default:o}},[],import.meta.url)).default.fire({icon:"success",title:"อนุมัติแล้ว"})}catch{}}catch(t){console.error("Approve failed:",t);try{await(await g(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"error",title:"อนุมัติไม่สำเร็จ"})}catch{}}finally{u.value=null}},L=async a=>{try{u.value=a.id,await $fetch(`${v}/api/admin/requests/${a.id}/reject`,{method:"POST",credentials:"include"}),d.value=d.value.filter(t=>t.id!==a.id);try{await(await g(async()=>{const{default:o}=await import("./DrhBs4VY.js");return{default:o}},[],import.meta.url)).default.fire({icon:"success",title:"ปฏิเสธแล้ว"})}catch{}}catch(t){console.error("Reject failed:",t);try{await(await g(async()=>{const{default:s}=await import("./DrhBs4VY.js");return{default:s}},[],import.meta.url)).default.fire({icon:"error",title:"ปฏิเสธไม่สำเร็จ"})}catch{}}finally{u.value=null}},T=a=>new Date(a).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Bangkok"});return A(S),(a,t)=>{const o=O;return i(),n("div",N,[e("div",I,[e("div",F,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white"},"คำขอ API Key"),e("p",{class:"mt-2 text-sm sm:text-base text-gray-600 dark:text-gray-400"},"อนุมัติ/ปฏิเสธคำขอจากผู้ใช้")],-1)),D(o,{to:"/",class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm whitespace-nowrap text-center"},{default:R(()=>[...t[2]||(t[2]=[l("กลับ",-1)])]),_:1})]),e("div",U,[e("div",H,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"ค้นหาชื่อ/อีเมล/บัญชี",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"พิมพ์คำค้น..."},null,512),[[V,p.value]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"กรองตามหน่วยงาน",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"},[t[5]||(t[5]=e("option",{value:""},"ทั้งหมด",-1)),(i(!0),n(k,null,h(C.value,s=>(i(),n("option",{key:s,value:s},r(s),9,K))),128))],512),[[B,m.value]])])]),x.value?(i(),n("div",Q,[...t[7]||(t[7]=[e("div",{class:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"},null,-1),e("p",{class:"text-gray-500 dark:text-gray-400"},"กำลังโหลดข้อมูล...",-1)])])):(i(),n("div",Z,[y.value.length===0?(i(),n("div",z," ไม่มีคำขอรออนุมัติ ")):(i(),n("div",G,[(i(!0),n(k,null,h(y.value,s=>(i(),n("div",{key:s.id,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 md:p-5 bg-gray-50 dark:bg-gray-700"},[e("div",J,[e("div",W,[e("h3",X,r(s.api_key_name),1),e("div",Y,[e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"ผู้ขอ:",-1)),l(" "+r(s.first_name)+" "+r(s.last_name),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"บัญชี:",-1)),l(" "+r(s.ubuaccount||"-"),1)]),e("p",null,[t[10]||(t[10]=e("span",{class:"font-medium"},"อีเมล:",-1)),t[11]||(t[11]=l()),e("span",q,r(s.email),1)]),e("p",null,[t[12]||(t[12]=e("span",{class:"font-medium"},"รหัสนักศึกษา/บุคลากร:",-1)),l(" "+r(s.student_id||"-"),1)]),e("p",tt,[t[13]||(t[13]=e("span",{class:"font-medium"},"คณะ/หน่วยงาน:",-1)),l(" "+r(s.department||"ไม่ระบุ"),1)]),e("p",null,[t[14]||(t[14]=e("span",{class:"font-medium"},"เครดิต:",-1)),l(" $"+r(s.credit_limit),1)]),e("p",null,[t[15]||(t[15]=e("span",{class:"font-medium"},"การใช้งานที่คาดหวัง:",-1)),l(" "+r(s.expected_usage||"-"),1)]),e("p",et,[t[16]||(t[16]=e("span",{class:"font-medium"},"วัตถุประสงค์:",-1)),l(" "+r(s.purpose||"-"),1)]),e("p",st,"ส่งเมื่อ: "+r(T(s.created_at)),1)])]),e("div",at,[e("button",{disabled:u.value===s.id,onClick:f=>L(s),class:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full text-white shadow-sm transition-all disabled:opacity-60 disabled:cursor-not-allowed bg-gradient-to-tr from-red-600 to-rose-600 hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-rose-400 text-sm whitespace-nowrap"},[...t[17]||(t[17]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),l(" ปฏิเสธ ",-1)])],8,ot),e("button",{disabled:u.value===s.id,onClick:f=>_(s),class:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full text-white shadow-sm transition-all disabled:opacity-60 disabled:cursor-not-allowed bg-gradient-to-tr from-green-600 to-emerald-600 hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-emerald-400 text-sm whitespace-nowrap"},[...t[18]||(t[18]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),l(" อนุมัติ ",-1)])],8,rt)])])]))),128))]))]))])])])}}});export{it as default};
